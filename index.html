<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>KetoCam AI</title>

    <!-- PWA bits -->
    <link rel="manifest" href="/manifest.webmanifest" />
    <meta name="theme-color" content="#0b1020" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <link rel="apple-touch-icon" href="/icons/icon-192.png" />

    <!-- Favicon fallback (optional) -->
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />

    <!-- 1) Show any runtime error instead of a silent blank page -->
    <script>
      window.addEventListener('error', (e) => {
        const div = document.createElement('div');
        div.style.cssText =
          'position:fixed;z-index:99999;left:0;right:0;top:0;background:#b00020;color:#fff;padding:10px;font:14px/1.4 system-ui';
        div.textContent = 'Runtime error: ' + (e?.error?.message || e.message || 'Unknown');
        document.body.prepend(div);
        console.error('Runtime error:', e.error || e);
      });
    </script>

    <!-- 2) SW killer helper (?sw-kill=1) -->
    <script>
      (function () {
        const u = new URL(location.href);
        if (u.searchParams.has('sw-kill')) {
          (async () => {
            try {
              const regs = await (navigator.serviceWorker?.getRegistrations?.() || []);
              for (const r of regs) await r.unregister();
              if (window.caches?.keys) {
                const keys = await caches.keys();
                await Promise.all(keys.map((k) => caches.delete(k)));
              }
              try { localStorage.clear?.(); } catch {}
              try { sessionStorage.clear?.(); } catch {}

              const b = document.createElement('div');
              b.textContent = 'Service worker & caches cleared. Reloadingâ€¦';
              b.style.cssText =
                'position:fixed;top:0;left:0;right:0;background:#0b1020;color:#fff;padding:8px;z-index:9999';
              document.body.appendChild(b);

              setTimeout(() => location.replace(u.origin + u.pathname), 400);
            } catch (e) {
              console.error('SW kill failed:', e);
            }
          })();
        }
      })();
    </script>
  </head>
  <body>
    <noscript>This app requires JavaScript to run.</noscript>
    <div id="root"></div>
    <!-- This bootstraps your React app -->
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>